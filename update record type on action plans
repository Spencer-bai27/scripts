// Query Action Plans with no parent relationships
List<LabsActionPlans__ActionPlan__c> actPlans = [
    SELECT Id, Name, CreatedDate, CreatedBy.Name 
    FROM LabsActionPlans__ActionPlan__c 
    WHERE 
        LabsActionPlans__Account__c = null AND
        LabsActionPlans__Campaign__c = null AND
        LabsActionPlans__Case__c = null AND
        LabsActionPlans__Contact__c = null AND
        LabsActionPlans__Contract__c = null AND
        LabsActionPlans__Lead__c = null AND
        LabsActionPlans__Opportunity__c = null AND
        Enrollment_Change__c = null
];

// First, get the APTask records related to these Action Plans
List<LabsActionPlans__APTask__c> apTasks = [
    SELECT Id 
    FROM LabsActionPlans__APTask__c 
    WHERE LabsActionPlans__Action_Plan__c IN :actPlans
];

// Then query Tasks related to those APTasks
List<Task> tasks = [
    SELECT Id, WhoId, WhatId 
    FROM Task 
    WHERE LabsActionPlans__TaskAPTask__c IN :apTasks  // Fixed field name
];

// Debug output with proper spacing
for(Task ta : tasks) {
    System.debug('Id: ' + ta.Id + ' | WhoId: ' + ta.WhoId + ' | WhatId: ' + ta.WhatId);
}
have to identify the tasks related to the action plan tasks related to these action plans and figure out from 
the who or what Id on them if I can update one of these fields

// Query the Record Type
RecordType rmTaskRecordType = [
    SELECT Id, SobjectType, Name 
    FROM RecordType 
    WHERE SobjectType = 'Task' AND Name = 'Resource Management' 
    LIMIT 1
];

// Initialize the list properly
List<LabsActionPlans__ActionPlanTemplate__c> updatedRMActionPlanTemplates = new List<LabsActionPlans__ActionPlanTemplate__c>();

// Query all Action Plan Templates
List<LabsActionPlans__ActionPlanTemplate__c> allRMActionPlanTemplates = [
    SELECT Id, Name, LabsActionPlans__TaskRecordTypeID__c 
    FROM LabsActionPlans__ActionPlanTemplate__c
];

// Update templates
for(LabsActionPlans__ActionPlanTemplate__c apt : allRMActionPlanTemplates) {
    apt.LabsActionPlans__TaskRecordTypeID__c = rmTaskRecordType.Id;
    updatedRMActionPlanTemplates.add(apt); // Add the object, not just the Id
}

// Perform DML operation
if(!updatedRMActionPlanTemplates.isEmpty()) {
    update updatedRMActionPlanTemplates;
}

// Initialize the list properly
List<LabsActionPlans__ActionPlan__c> updatedRMActionPlans = new List<LabsActionPlans__ActionPlan__c>();

// Query related Action Plans
List<LabsActionPlans__ActionPlan__c> allRMActionPlans = [
    SELECT Id, Name, LabsActionPlans__Action_Plan_Template__c, LabsActionPlans__TaskRecordTypeID__c 
    FROM LabsActionPlans__ActionPlan__c 
    WHERE LabsActionPlans__Action_Plan_Template__c IN :allRMActionPlanTemplates
];

// Update action plans
for(LabsActionPlans__ActionPlan__c ap : allRMActionPlans) {
    ap.LabsActionPlans__TaskRecordTypeID__c = rmTaskRecordType.Id;
    updatedRMActionPlans.add(ap);
}

// Perform DML operation
if(!updatedRMActionPlans.isEmpty()) {
    update updatedRMActionPlans;
}
